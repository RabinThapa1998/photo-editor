<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Image with Overlay Text</title>
        <style>
            .image-container {
                position: relative;
                width: 400px;
                height: 500px;
                overflow: hidden;
            }

            .image-container img {
                width: 100%;
                height: auto;
            }

            .overlay-text {
                position: absolute;
                top: 50%;
                left: 50%;
                max-width: 70%;
                padding: 20px;
                transform: translate(-50%, -50%);
                color: black;
                background-color: white;
                font-size: 24px;
                font-weight: bold;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <input
            type="file"
            id="imageInput"
            accept="image/*"
            onchange="getImageSize()"
        />
        <textarea rows="4" cols="50" id="overlay-text-input"> </textarea>

        <div class="image-container">
            <img alt="Your Image" id="editable-img" />
            <div class="overlay-text" id="overlay-text"></div>
        </div>

        <button onclick="downloadImage()">Download Image</button>

        <script>
            const baseFontSize = 24;
            var aspectRatio;
            var canvas;
            var canvasImg = new Image(); // Initialize canvasImg globally

            function downloadImage() {
                var context = canvas.getContext('2d');

                canvasImg.crossOrigin = 'anonymous';

                canvasImg.onload = function () {
                    context.drawImage(canvasImg, 0, 0);

                    context.font = `${baseFontSize * aspectRatio}px` + ' bold';
                    context.fillStyle = 'white';
                    context.textAlign = 'center';
                    const overlayText = document.querySelector(
                        '#overlay-text-input'
                    ).value;

                    context.fillText(
                        overlayText,
                        canvas.width / 2,
                        canvas.height / 2
                    );

                    var link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = 'image_with_overlay.png';
                    link.click();
                };
            }

            function getImageSize() {
                var input = document.getElementById('imageInput');

                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        const img = new Image();
                        img.src = e.target.result;

                        img.onload = function () {
                            var width = img.width;
                            var height = img.height;

                            // Calculate the aspect ratio of the original image
                            aspectRatio = width / height;

                            const canvasImgElement =
                                document.querySelector('#editable-img');
                            canvasImgElement.src = e.target.result;

                            // Calculate the new width and height for the canvas
                            var newWidth, newHeight;
                            if (aspectRatio > 1) {
                                newWidth = 400;
                                newHeight = 400 / aspectRatio;
                            } else {
                                newWidth = 500 * aspectRatio;
                                newHeight = 500;
                            }

                            canvasImgElement.style.width = newWidth + 'px';
                            canvasImgElement.style.height = newHeight + 'px';

                            // Create a canvas with new dimensions
                            canvas = document.createElement('canvas');
                            canvas.width = width;
                            canvas.height = height;

                            canvasImg.src = e.target.result;
                        };
                    };

                    reader.readAsDataURL(input.files[0]);
                }
            }

            const inputHandler = function (e) {
                console.log('ðŸš€ ~ inputHandler ~ e:', e);
                // result.innerText = e.target.value;
                document.querySelector('#overlay-text').innerText =
                    e.target.value;
            };
            const overlayInput = document.querySelector('#overlay-text-input');
            overlayInput.addEventListener('input', (e) => inputHandler(e));
        </script>
    </body>
</html>
