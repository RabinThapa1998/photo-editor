<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Image with Overlay Text</title>
        <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    </head>
    <body>
        <h1>Image with Overlay Text</h1>

        <!-- Input for image upload -->
        <label for="imageUpload">Upload Image:</label>
        <input
            type="file"
            id="imageUpload"
            accept="image/*"
            onchange="onImageUpload()"
        />

        <!-- Input for image viewer -->
        <label for="imageViewer">Image Viewer:</label>
        <div
            id="imageViewer"
            style="
                width: 600px;
                height: 400px;
                border: 1px solid black;
                overflow: hidden;
                position: relative;
            "
        >
            <!-- Image will be displayed here -->
        </div>

        <!-- Input for overlay text -->
        <label for="overlayText">Overlay Text:</label>
        <textarea
            type="text"
            id="overlayText"
            placeholder="Enter overlay text"
            oninput="updateOverlayPreview()"
        >
        </textarea>

        <!-- Preview of overlay text on the image -->
        <div id="overlayPreview" style="margin-top: 10px"></div>

        <button onclick="onDownload()">Download Image with Overlay</button>

        <script>
            function drag(event) {
                // Set the data to be transferred during the drag
                event.dataTransfer.setData('text/plain', event.target.id);
            }

            function onImageUpload() {
                var imageUploadInput = document.getElementById('imageUpload');
                var imageViewer = document.getElementById('imageViewer');
                var overlayText = document.getElementById('overlayText').value;

                if (imageUploadInput.files && imageUploadInput.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        imageViewer.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image" style="width: 100%;" draggable="true" ondragstart="drag(event)" >`;

                        updateOverlayPreview();
                    };

                    reader.readAsDataURL(imageUploadInput.files[0]);
                }
            }

            function updateOverlayPreview() {
                var overlayContainer =
                    document.getElementById('overlayContainer');
                var overlayText = document.getElementById('overlayText').value;

                // Ensure that overlayContainer is created
                if (!overlayContainer) {
                    overlayContainer = document.createElement('div');
                    overlayContainer.id = 'overlayContainer';
                    overlayContainer.style.position = 'absolute';
                    overlayContainer.style.zIndex = '9999';
                    overlayContainer.style.top = '0';
                    overlayContainer.style.left = '0';
                    overlayContainer.style.width = '100%';
                    overlayContainer.style.height = '100%';
                    document
                        .getElementById('imageViewer')
                        .appendChild(overlayContainer);
                }

                // Clear previous overlay text
                overlayContainer.innerHTML = '';

                // Add new overlay text inside a white container
                var whiteContainer = document.createElement('div');
                whiteContainer.style.position = 'absolute';
                whiteContainer.style.top = '50%';
                whiteContainer.style.left = '50%';
                whiteContainer.style.transform = 'translate(-50%, -50%)';
                whiteContainer.style.maxWidth = '80%';
                whiteContainer.style.backgroundColor =
                    'rgba(255, 255, 255, 0.7)';
                whiteContainer.style.padding = '10px';
                whiteContainer.style.textAlign = 'center';

                // Add the text to the white container
                var overlayTextElement = document.createElement('div');
                overlayTextElement.textContent = overlayText;
                overlayTextElement.style.color = 'black';
                overlayTextElement.style.fontSize = '24px';
                overlayTextElement.style.fontWeight = 'bold';
                whiteContainer.appendChild(overlayTextElement);

                overlayContainer.appendChild(whiteContainer);
            }

            function onDownload() {
                var imageViewer = document.getElementById('imageViewer');
                var overlayText = document.getElementById('overlayText').value;

                html2canvas(imageViewer, {
                    useCORS: true, // Enable CORS support for external images
                }).then((canvas) => {
                    // Draw the overlay text on the canvas
                    // var context = canvas.getContext('2d');
                    // context.font = '24px bold'; // Set a default font size for the canvas
                    // context.fillStyle = 'white'; // Set a default text color for the canvas
                    // context.textAlign = 'center';
                    // context.fillText(
                    //     overlayText,
                    //     canvas.width / 2,
                    //     canvas.height / 2
                    // );

                    var link = document.createElement('a');
                    link.href = canvas.toDataURL('image/png');
                    link.download = 'image_with_overlay.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            }
        </script>
    </body>
</html>
